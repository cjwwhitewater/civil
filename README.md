# 天气查询系统 Demo

一个基于Python Flask的天气查询Web应用，通过爬虫技术从中国天气网获取实时天气信息，并支持历史天气数据存储和查询。

## 功能特性

- 🌤️ **实时天气查询**：支持查询全国主要城市的天气信息
- 🕷️ **爬虫技术**：使用网页爬虫而非API接口获取数据
- 📅 **历史天气记录**：自动存储每日天气数据，支持历史查询
- ⏰ **定时任务**：每天自动获取所有城市天气信息
- 🎨 **现代化UI**：美观的响应式界面设计
- 📱 **移动端适配**：支持手机和平板设备访问
- ⚡ **快速响应**：优化的前端交互体验

## 技术栈

### 后端
- **Python 3.7+**
- **Flask** - Web框架
- **Flask-SQLAlchemy** - 数据库ORM
- **APScheduler** - 定时任务调度
- **Requests** - HTTP请求库
- **BeautifulSoup4** - HTML解析库
- **lxml** - XML/HTML解析器

### 前端
- **HTML5** - 页面结构
- **CSS3** - 样式设计（渐变、动画、响应式）
- **JavaScript (ES6+)** - 交互逻辑

### 数据库
- **SQLite** - 轻量级数据库，存储历史天气数据

## 项目结构

```
civil/
├── app.py                 # Flask主应用文件
├── models.py              # 数据库模型定义
├── fetch_weather.py       # 手动获取天气数据脚本
├── requirements.txt       # Python依赖包
├── weather.db            # SQLite数据库文件（自动生成）
├── templates/
│   ├── index.html        # 实时天气查询页面
│   └── history.html      # 历史天气查询页面
├── start.bat             # Windows启动脚本
├── INSTALL.md            # 详细安装指南
└── README.md             # 项目说明文档
```

## 安装和运行

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 运行应用

```bash
python app.py
```

### 3. 访问应用

打开浏览器访问：`http://localhost:5000`

## 使用说明

### 实时天气查询
1. **输入城市名称**：在搜索框中输入要查询的城市名称
2. **点击查询**：点击"查询天气"按钮或按回车键
3. **查看结果**：系统将显示该城市的天气信息，包括：
   - 天气状况
   - 温度
   - 湿度
   - 风向
   - 空气质量
   - 日出日落时间
   - 生活指数

### 历史天气查询
1. **点击"历史天气"**：在主页点击导航按钮
2. **选择城市**：从下拉列表中选择要查询的城市
3. **选择日期**（可选）：指定查询特定日期的天气记录
4. **查看历史**：系统将显示该城市的历史天气记录

### 手动获取天气数据
如果需要立即获取所有城市的天气数据，可以运行：

```bash
python fetch_weather.py
```

测试脚本会检查多个城市的天气信息提取效果，并验证数据长度是否合理。

### 数据库管理
项目提供了数据库管理工具，可以管理历史天气数据：

```bash
python manage_db.py
```

管理工具功能包括：
- 查看数据统计信息
- 查看所有城市列表
- 查看指定城市的历史记录
- 清空所有历史数据
- 清空指定城市的数据
- 清空指定日期的数据
- 导出数据统计报告

## 示例城市

系统支持以下城市（共40个）：
- 北京、上海、广州、深圳、杭州
- 南京、武汉、成都、西安、天津
- 重庆、青岛、大连、厦门、苏州
- 无锡、宁波、长沙、郑州、济南
- 哈尔滨、沈阳、长春、石家庄、太原
- 呼和浩特、合肥、福州、南昌、南宁
- 海口、昆明、贵阳、拉萨、兰州
- 西宁、银川、乌鲁木齐

## 技术实现

### 爬虫策略

1. **直接访问城市页面**：使用城市代码直接访问天气页面
2. **数据解析**：使用BeautifulSoup解析HTML获取天气数据
3. **反爬虫措施**：
   - 设置合理的User-Agent
   - 添加随机延迟
   - 模拟真实浏览器行为

### 数据存储

1. **数据库设计**：使用SQLAlchemy ORM管理数据库
2. **定时任务**：每天上午9点自动获取所有城市天气
3. **数据更新**：避免重复记录，支持数据更新

### 数据提取

系统会尝试提取以下天气信息：
- 城市名称和代码
- 当前天气状况
- 温度信息
- 湿度数据
- 风向风速
- 日出日落时间
- 空气质量指数
- 生活指数（穿衣、感冒、运动、紫外线）

### 数据优化

系统对提取的数据进行了优化处理：
- **过滤JavaScript数据**：自动过滤掉包含JavaScript变量的长文本
- **长度限制**：对风向、温度等信息进行长度限制，避免显示过长
- **精确匹配**：使用正则表达式精确匹配天气信息
- **多重验证**：通过多种方法确保获取到有效的天气数据

## 测试功能

项目提供了测试脚本来验证天气信息提取功能：

```bash
python test_weather.py
```

测试脚本会检查多个城市的天气信息提取效果，并验证数据长度是否合理。

## 定时任务

系统配置了定时任务，每天上午9点自动获取所有城市的天气信息：

- **执行时间**：每天 09:00
- **执行内容**：获取所有40个城市的天气数据
- **存储方式**：保存到SQLite数据库
- **重复处理**：避免同一天重复记录

## 注意事项

- 由于网站结构可能发生变化，爬虫可能需要定期更新
- 请合理使用，避免频繁请求对目标网站造成压力
- 定时任务需要应用持续运行才能正常工作
- 建议在生产环境中添加缓存机制和错误重试功能

## 开发说明

这个demo展示了如何使用爬虫技术获取网站数据，适用于：
- 学习网页爬虫技术
- 理解前后端分离架构
- 学习数据库设计和定时任务
- 作为最终Web项目的技术验证

## 许可证

本项目仅用于学习和演示目的。
